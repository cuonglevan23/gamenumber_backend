# ğŸ® Number Guessing Game - Spring Boot Application

[![Java](https://img.shields.io/badge/Java-21-orange.svg)](https://www.oracle.com/java/)
[![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.5.6-green.svg)](https://spring.io/projects/spring-boot)
[![MySQL](https://img.shields.io/badge/MySQL-8.0-blue.svg)](https://www.mysql.com/)
[![Redis](https://img.shields.io/badge/Redis-7-red.svg)](https://redis.io/)

Game Ä‘oÃ¡n sá»‘ vá»›i há»‡ thá»‘ng xÃ¡c thá»±c JWT, Redis caching, vÃ  MySQL database Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a vá»›i indexing.

## ğŸ“‹ Má»¥c lá»¥c
- [TÃ­nh nÄƒng](#-tÃ­nh-nÄƒng)
- [Kiáº¿n trÃºc](#-kiáº¿n-trÃºc)
- [YÃªu cáº§u há»‡ thá»‘ng](#-yÃªu-cáº§u-há»‡-thá»‘ng)
- [CÃ i Ä‘áº·t](#-cÃ i-Ä‘áº·t)
- [Cháº¡y á»©ng dá»¥ng](#-cháº¡y-á»©ng-dá»¥ng)
- [API Documentation](#-api-documentation)
- [Tá»‘i Æ°u hÃ³a & Indexing](#-tá»‘i-Æ°u-hÃ³a--indexing)
- [Testing](#-testing)

## âœ¨ TÃ­nh nÄƒng

### Chá»©c nÄƒng chÃ­nh
- âœ… **ÄÄƒng kÃ½/ÄÄƒng nháº­p** vá»›i JWT authentication
- âœ… **ÄoÃ¡n sá»‘** tá»« 1-5 vá»›i tá»· lá»‡ tháº¯ng Ä‘Æ°á»£c Ä‘iá»u chá»‰nh (5%)
- âœ… **Mua lÆ°á»£t chÆ¡i** (5 turns/láº§n mua)
- âœ… **Leaderboard** top 10 ngÆ°á»i chÆ¡i
- âœ… **ThÃ´ng tin user** (email, score, turns cÃ²n láº¡i)

### TÃ­nh nÄƒng nÃ¢ng cao
- ğŸ”’ **Pessimistic Locking** + **Distributed Lock (Redis)** cho concurrent requests
- âš¡ **Redis Caching** cho leaderboard vÃ  user info
- ğŸ“Š **MySQL Indexing** tá»‘i Æ°u cho performance
- ğŸ” **JWT Security** vá»›i refresh token
- ğŸ“ **Game History** tracking
- ğŸ’³ **Transaction History** cho mua lÆ°á»£t

## ğŸ—ï¸ Kiáº¿n trÃºc

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ HTTP/REST
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Spring Boot Application        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Security (JWT Filter)      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      Controllers             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚       Services               â”‚  â”‚
â”‚  â”‚  - Auth Service              â”‚  â”‚
â”‚  â”‚  - Game Service (Lock)       â”‚  â”‚
â”‚  â”‚  - User Service (Cache)      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      Repositories            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚
        â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MySQL DB     â”‚   â”‚   Redis     â”‚
â”‚  (Indexed)    â”‚   â”‚  (Cache)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ’» YÃªu cáº§u há»‡ thá»‘ng

- **Java**: 21 hoáº·c cao hÆ¡n
- **Docker** & **Docker Compose**: PhiÃªn báº£n má»›i nháº¥t
- **Gradle**: 8.5+ (hoáº·c sá»­ dá»¥ng wrapper)
- **Git**: Äá»ƒ clone project

## ğŸš€ CÃ i Ä‘áº·t

### 1. Clone repository
```bash
git clone <repository-url>
cd gamenumber
```

### 2. Cáº¥u hÃ¬nh mÃ´i trÆ°á»ng (Optional)

Táº¥t cáº£ cáº¥u hÃ¬nh Ä‘Ã£ Ä‘Æ°á»£c setup sáºµn trong `docker-compose.yml` vÃ  `application-docker.properties`.

Náº¿u muá»‘n thay Ä‘á»•i, chá»‰nh sá»­a file `docker-compose.yml`:
```yaml
environment:
  JWT_SECRET: your-custom-secret-key-min-256-bits
  JWT_EXPIRATION: 86400000
```

## ğŸƒ Cháº¡y á»©ng dá»¥ng

### Option 1: Sá»­ dá»¥ng Docker Compose (Khuyáº¿n nghá»‹)

```bash
# Build vÃ  start táº¥t cáº£ services (MySQL, Redis, Spring Boot App)
docker-compose up --build

# Hoáº·c cháº¡y background
docker-compose up -d --build

# Xem logs
docker-compose logs -f app

# Stop services
docker-compose down

# Stop vÃ  xÃ³a volumes (reset database)
docker-compose down -v
```

Application sáº½ cháº¡y táº¡i: **http://localhost:8080**

### Option 2: Cháº¡y local (Development)

**BÆ°á»›c 1: Start MySQL vÃ  Redis**
```bash
docker-compose up mysql redis -d
```

**BÆ°á»›c 2: Cháº¡y Spring Boot application**
```bash
./gradlew bootRun
```

### Option 3: Build JAR vÃ  cháº¡y

```bash
# Build
./gradlew clean bootJar

# Run
java -jar build/libs/gamenumber-0.0.1-SNAPSHOT.jar
```

## ğŸ“š API Documentation

### Base URL
```
http://localhost:8080/api
```

### 1. Authentication APIs

#### Register
```bash
POST /api/auth/register
Content-Type: application/json

{
  "username": "player1",
  "email": "player1@example.com",
  "password": "password123"
}

Response:
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "username": "player1",
  "message": "User registered successfully"
}
```

#### Login
```bash
POST /api/auth/login
Content-Type: application/json

{
  "username": "player1",
  "password": "password123"
}

Response:
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "username": "player1",
  "message": "Login successful"
}
```

### 2. Game APIs (Requires Authentication)

#### Guess Number
```bash
POST /api/game/guess
Authorization: Bearer <token>
Content-Type: application/json

{
  "number": 3
}

Response:
{
  "correct": true,
  "guessedNumber": 3,
  "actualNumber": 3,
  "scoreEarned": 1,
  "totalScore": 11,
  "remainingTurns": 4,
  "message": "Congratulations! You won!"
}
```

### 3. User APIs

#### Get User Info (Requires Authentication)
```bash
GET /api/me
Authorization: Bearer <token>

Response:
{
  "username": "player1",
  "email": "player1@example.com",
  "score": 11,
  "turns": 4,
  "rank": 2
}
```

#### Buy Turns (Requires Authentication)
```bash
POST /api/buy-turns
Authorization: Bearer <token>

Response:
"Successfully purchased 5 turns. Total turns: 9"
```

#### Get Leaderboard (Public)
```bash
GET /api/leaderboard

Response:
[
  {
    "rank": 1,
    "username": "player2",
    "score": 15,
    "totalGames": 20,
    "winRate": 75.0
  },
  {
    "rank": 2,
    "username": "player1",
    "score": 10,
    "totalGames": 15,
    "winRate": 66.67
  }
]
```

### ğŸ“ Postman Collection

#### Quick Test Flow:

1. **Register**
```bash
curl -X POST http://localhost:8080/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser","email":"test@test.com","password":"password123"}'
```

2. **Login & Get Token**
```bash
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser","password":"password123"}'
```

3. **Guess Number** (replace TOKEN)
```bash
curl -X POST http://localhost:8080/api/game/guess \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"number":3}'
```

4. **Get User Info**
```bash
curl -X GET http://localhost:8080/api/me \
  -H "Authorization: Bearer TOKEN"
```

5. **Buy Turns**
```bash
curl -X POST http://localhost:8080/api/buy-turns \
  -H "Authorization: Bearer TOKEN"
```

6. **Get Leaderboard**
```bash
curl -X GET http://localhost:8080/api/leaderboard
```

## âš¡ Tá»‘i Æ°u hÃ³a & Indexing

### 1. MySQL Indexing Strategy

#### Users Table
```sql
-- Primary Index
PRIMARY KEY (id)

-- Search by username (login)
INDEX idx_username (username)

-- Leaderboard query
INDEX idx_score_desc (score DESC)

-- Search by email
INDEX idx_email (email)
```

#### Game History Table
```sql
-- User's game history
INDEX idx_user_id (user_id)
INDEX idx_user_played (user_id, played_at DESC)

-- Analytics
INDEX idx_played_at (played_at)
INDEX idx_correct_games (is_correct, played_at)
```

#### Transactions Table
```sql
INDEX idx_user_transactions (user_id, created_at DESC)
INDEX idx_transaction_type (transaction_type)
```

### 2. Redis Caching Strategy

#### Cache Keys:
- `leaderboard:top10` - Top 10 leaderboard (TTL: 5 minutes)
- `leaderboard:scores` - Redis Sorted Set cho scores
- `user:{userId}` - User information cache (TTL: 30 minutes)
- `game:lock:{userId}` - Distributed lock cho concurrent requests

#### Cache Flow:
```
Request â†’ Check Redis â†’ Hit? Return cached data
                     â†’ Miss? Query DB â†’ Cache result â†’ Return
```

### 3. Concurrency Control

#### Pessimistic Locking
```java
@Lock(LockModeType.PESSIMISTIC_WRITE)
@Query("SELECT u FROM User u WHERE u.id = :id")
Optional<User> findByIdWithLock(@Param("id") Long id);
```

#### Distributed Lock (Redis)
```java
Boolean lockAcquired = redisTemplate.opsForValue()
    .setIfAbsent(lockKey, "locked", 5, TimeUnit.SECONDS);
```

### 4. Database Connection Pool
```properties
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
```

## ğŸ§ª Testing

### Kiá»ƒm tra services Ä‘Ã£ cháº¡y
```bash
# Check MySQL
docker-compose exec mysql mysql -u gameuser -pgamepassword -e "SHOW DATABASES;"

# Check Redis
docker-compose exec redis redis-cli ping

# Check Spring Boot logs
docker-compose logs -f app
```

### Test concurrent requests
```bash
# Install Apache Bench (if not installed)
# macOS: brew install httpd

# Test 100 concurrent guess requests
ab -n 100 -c 10 -p guess.json -T application/json \
   -H "Authorization: Bearer YOUR_TOKEN" \
   http://localhost:8080/api/game/guess
```

## ğŸ”§ Troubleshooting

### Port already in use
```bash
# Change port in docker-compose.yml
ports:
  - "8081:8080"  # Use port 8081 instead
```

### Reset database
```bash
docker-compose down -v
docker-compose up --build
```

### View logs
```bash
# All services
docker-compose logs -f

# Specific service
docker-compose logs -f app
docker-compose logs -f mysql
docker-compose logs -f redis
```

## ğŸ“Š Performance Metrics

- **Leaderboard query**: < 50ms (vá»›i Redis cache)
- **User info query**: < 30ms (vá»›i Redis cache)
- **Guess operation**: < 100ms (vá»›i distributed lock)
- **Concurrent requests**: Xá»­ lÃ½ Ä‘Æ°á»£c 100+ requests/second

## ğŸ”’ Security Features

1. **JWT Authentication** - Token-based vá»›i expiration
2. **Password Encryption** - BCrypt hashing
3. **CORS Configuration** - Configurable origins
4. **SQL Injection Prevention** - JPA/Hibernate parameterized queries
5. **Distributed Locking** - Prevent race conditions

## ğŸ“ˆ Scalability

- **Horizontal Scaling**: Stateless application, cÃ³ thá»ƒ cháº¡y nhiá»u instances
- **Database Optimization**: Proper indexing, connection pooling
- **Caching Layer**: Redis cho high-throughput reads
- **Async Processing**: Ready cho event-driven architecture

## ğŸ“ License

MIT License

## ğŸ‘¥ Author

Game Number Team

---

**ChÃºc báº¡n vui váº» vá»›i game! ğŸ®**

